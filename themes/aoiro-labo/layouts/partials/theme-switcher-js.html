<script>
    const html = document.documentElement;
    // PC/モバイルのテーマトグルボタンとアイコン
    const toggleThemePC = document.getElementById("toggleThemePC");
    const toggleThemeMobile = document.getElementById("toggleThemeMobile");
    const iconMoonPC = document.getElementById("icon-moon-pc");
    const iconSunPC = document.getElementById("icon-sun-pc");
    const iconMoonMobile = document.getElementById("icon-moon-mobile");
    const iconSunMobile = document.getElementById("icon-sun-mobile");
    // モバイルメニュー関連
    const toggleMenuButton = document.getElementById("toggleMenuMobile");
    const mobileNavContainer = document.getElementById("mobile-nav-container");
    const iconMenu = document.getElementById("icon-menu");
    const iconClose = document.getElementById("icon-close");

    // 1. テーマの初期設定
    function initializeTheme() {
        const savedTheme = localStorage.getItem('theme');
        let initialTheme = 'light';
        // ローカルストレージ優先、次にシステム設定
        if (savedTheme) { initialTheme = savedTheme; }
        else if (window.matchMedia('(prefers-color-scheme: dark)').matches) { initialTheme = 'dark'; }
        
        // Tailwindの設定に基づき、HTMLタグに 'dark' クラスを適用
        html.classList.toggle('dark', initialTheme === 'dark');
        updateIcons(initialTheme);
    }

    // 2. アイコンの表示を更新する関数
    function updateIcons(theme) {
        const isDark = theme === 'dark';
        if (iconMoonPC) iconMoonPC.style.display = isDark ? "block" : "none";
        if (iconSunPC) iconSunPC.style.display = isDark ? "none" : "block";
        if (iconMoonMobile) iconMoonMobile.style.display = isDark ? "block" : "none";
        if (iconSunMobile) iconSunMobile.style.display = isDark ? "none" : "block";
    }

    // 3. テーマトグル処理関数
    function toggleTheme() {
        const isDark = html.classList.contains('dark');
        const newTheme = isDark ? "light" : "dark";
        html.classList.toggle('dark', newTheme === 'dark');
        localStorage.setItem('theme', newTheme);
        updateIcons(newTheme);
    }

    // 4. モバイルメニューのトグル処理
    function toggleMobileMenu() {
        const isMenuClosed = mobileNavContainer.classList.toggle('hidden');
        if (iconMenu) iconMenu.classList.toggle('hidden', !isMenuClosed);
        if (iconClose) iconClose.classList.toggle('hidden', isMenuClosed);
    }

    // 5. イベントリスナーの設定
    if (toggleThemePC) toggleThemePC.addEventListener('click', toggleTheme);
    if (toggleThemeMobile) toggleThemeMobile.addEventListener('click', toggleTheme);
    if (toggleMenuButton) toggleMenuButton.addEventListener('click', toggleMobileMenu);

    // 6. ページロード時にテーマを初期化
    window.addEventListener('load', initializeTheme);
</script>